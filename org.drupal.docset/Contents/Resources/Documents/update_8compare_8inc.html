<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Drupal: modules/update/update.compare.inc File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Drupal
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">modules/update/update.compare.inc File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a7e1ea49d91f2d2b81b8101d481d10300"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8compare_8inc.html#a7e1ea49d91f2d2b81b8101d481d10300">update_get_projects</a> ()</td></tr>
<tr class="memitem:a37eb8774bbb961b5d1113c116aba2f3b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8compare_8inc.html#a37eb8774bbb961b5d1113c116aba2f3b">_update_process_info_list</a> (&amp;$projects, $list, $project_type, $status)</td></tr>
<tr class="memitem:a02c561b213ab3df2e929917736dc2b7b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8compare_8inc.html#a02c561b213ab3df2e929917736dc2b7b">update_get_project_name</a> ($file)</td></tr>
<tr class="memitem:ad14173209d3e9cf76fbd6d6d1977de05"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8compare_8inc.html#ad14173209d3e9cf76fbd6d6d1977de05">update_process_project_info</a> (&amp;$projects)</td></tr>
<tr class="memitem:aa0663304dc4634e4109c896f214ea791"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8compare_8inc.html#aa0663304dc4634e4109c896f214ea791">update_calculate_project_data</a> ($available)</td></tr>
<tr class="memitem:a964a0180687773bb39b53482d7106545"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8compare_8inc.html#a964a0180687773bb39b53482d7106545">update_calculate_project_update_status</a> ($project, &amp;$project_data, $available)</td></tr>
<tr class="memitem:a958705ecce49b020722280decff3f644"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8compare_8inc.html#a958705ecce49b020722280decff3f644">update_project_cache</a> ($cid)</td></tr>
<tr class="memitem:a8d1c29cf668adf2ea2a1a34f0f716cd1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8compare_8inc.html#a8d1c29cf668adf2ea2a1a34f0f716cd1">update_filter_project_info</a> ($info)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Code required only when comparing available updates to existing data. </p>
</div><hr/><h2>Function Documentation</h2>
<a class="anchor" id="a37eb8774bbb961b5d1113c116aba2f3b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="update_8compare_8inc.html#a37eb8774bbb961b5d1113c116aba2f3b">_update_process_info_list</a> </td>
          <td>(</td>
          <td class="paramtype">&amp;$&#160;</td>
          <td class="paramname"><em>projects</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>project_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>status</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Populate an array of project data.</p>
<p>This iterates over a list of the installed modules or themes and groups them by project and status. A few parts of this function assume that enabled modules and themes are always processed first, and if disabled modules or themes are being processed (there is a setting to control if disabled code should be included in the Available updates report or not), those are only processed after $projects has been populated with information about the enabled code. 'Hidden' modules and themes are always ignored. This function also records the latest change time on the .info files for each module or theme, which is important data which is used when deciding if the cached available update data should be invalidated.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">$projects</td><td>Reference to the array of project data of what's installed on this site. </td></tr>
    <tr><td class="paramname">$list</td><td>Array of data to process to add the relevant info to the $projects array. </td></tr>
    <tr><td class="paramname">$project_type</td><td>The kind of data in the list (can be 'module' or 'theme'). </td></tr>
    <tr><td class="paramname">$status</td><td>Boolean that controls what status (enabled or disabled) to process out of the $list and add to the $projects array.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also:</dt><dd><a class="el" href="update_8compare_8inc.html#a7e1ea49d91f2d2b81b8101d481d10300">update_get_projects()</a> </dd></dl>

</div>
</div>
<a class="anchor" id="aa0663304dc4634e4109c896f214ea791"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="update_8compare_8inc.html#aa0663304dc4634e4109c896f214ea791">update_calculate_project_data</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>available</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Calculate the current update status of all projects on the site.</p>
<p>The results of this function are expensive to compute, especially on sites with lots of modules or themes, since it involves a lot of comparisons and other operations. Therefore, we cache the results into the {cache_update} table using the 'update_project_data' cache ID. However, since this is not the data about available updates fetched from the network, it is ok to invalidate it somewhat quickly. If we keep this data for very long, site administrators are more likely to see incorrect results if they upgrade to a newer version of a module or theme but do not visit certain pages that automatically clear this cache.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$available</td><td>Data about available project releases.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also:</dt><dd>update_get_available() </dd>
<dd>
<a class="el" href="update_8compare_8inc.html#a7e1ea49d91f2d2b81b8101d481d10300">update_get_projects()</a> </dd>
<dd>
<a class="el" href="update_8compare_8inc.html#ad14173209d3e9cf76fbd6d6d1977de05">update_process_project_info()</a> </dd>
<dd>
<a class="el" href="update_8compare_8inc.html#a958705ecce49b020722280decff3f644">update_project_cache()</a> </dd></dl>

</div>
</div>
<a class="anchor" id="a964a0180687773bb39b53482d7106545"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="update_8compare_8inc.html#a964a0180687773bb39b53482d7106545">update_calculate_project_update_status</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>project</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&amp;$&#160;</td>
          <td class="paramname"><em>project_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>available</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Calculate the current update status of a specific project.</p>
<p>This function is the heart of the update status feature. For each project it is invoked with, it first checks if the project has been flagged with a special status like "unsupported" or "insecure", or if the project node itself has been unpublished. In any of those cases, the project is marked with an error and the next project is considered.</p>
<p>If the project itself is valid, the function decides what major release series to consider. The project defines what the currently supported major versions are for each version of core, so the first step is to make sure the current version is still supported. If so, that's the target version. If the current version is unsupported, the project maintainer's recommended major version is used. There's also a check to make sure that this function never recommends an earlier release than the currently installed major version.</p>
<p>Given a target major version, it scans the available releases looking for the specific release to recommend (avoiding beta releases and development snapshots if possible). This is complicated to describe, but an example will help clarify. For the target major version, find the highest patch level. If there is a release at that patch level with no extra ("beta", etc), then we recommend the release at that patch level with the most recent release date. If every release at that patch level has extra (only betas), then recommend the latest release from the previous patch level. For example:</p>
<p>1.6-bugfix &lt;-- recommended version because 1.6 already exists. 1.6</p>
<p>or</p>
<p>1.6-beta 1.5 &lt;-- recommended version because no 1.6 exists. 1.4</p>
<p>It also looks for the latest release from the same major version, even a beta release, to display to the user as the "Latest version" option. Additionally, it finds the latest official release from any higher major versions that have been released to provide a set of "Also available" options.</p>
<p>Finally, and most importantly, it keeps scanning the release history until it gets to the currently installed release, searching for anything marked as a security update. If any security updates have been found between the recommended release and the installed version, all of the releases that included a security fix are recorded so that the site administrator can be warned their site is insecure, and links pointing to the release notes for each security update can be included (which, in turn, will link to the official security announcements for each vulnerability).</p>
<p>This function relies on the fact that the .xml release history data comes sorted based on major version and patch level, then finally by release date if there are multiple releases such as betas from the same major.patch version (e.g. 5.x-1.5-beta1, 5.x-1.5-beta2, and 5.x-1.5). Development snapshots for a given major version are always listed last. </p>

</div>
</div>
<a class="anchor" id="a8d1c29cf668adf2ea2a1a34f0f716cd1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="update_8compare_8inc.html#a8d1c29cf668adf2ea2a1a34f0f716cd1">update_filter_project_info</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>info</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Filter the project .info data to only save attributes we need.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$info</td><td>Array of .info file data as returned by <a class="el" href="common_8inc.html#a277955232059631211fcfde533ea89d6">drupal_parse_info_file()</a>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>Array of .info file data we need for the Update manager.</dd></dl>
<dl class="section see"><dt>See also:</dt><dd><a class="el" href="update_8compare_8inc.html#a37eb8774bbb961b5d1113c116aba2f3b">_update_process_info_list()</a> </dd></dl>

</div>
</div>
<a class="anchor" id="a02c561b213ab3df2e929917736dc2b7b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="update_8compare_8inc.html#a02c561b213ab3df2e929917736dc2b7b">update_get_project_name</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>file</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Given a $file object (as returned by system_get_files_database()), figure out what project it belongs to.</p>
<dl class="section see"><dt>See also:</dt><dd>system_get_files_database() </dd></dl>

</div>
</div>
<a class="anchor" id="a7e1ea49d91f2d2b81b8101d481d10300"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="update_8compare_8inc.html#a7e1ea49d91f2d2b81b8101d481d10300">update_get_projects</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Fetch an array of installed and enabled projects.</p>
<p>This is only responsible for generating an array of projects (taking into account projects that include more than one module or theme). Other information like the specific version and install type (official release, dev snapshot, etc) is handled later in <a class="el" href="update_8compare_8inc.html#ad14173209d3e9cf76fbd6d6d1977de05">update_process_project_info()</a> since that logic is only required when preparing the status report, not for fetching the available release data.</p>
<p>This array is fairly expensive to construct, since it involves a lot of disk I/O, so we cache the results into the {cache_update} table using the 'update_project_projects' cache ID. However, since this is not the data about available updates fetched from the network, it is ok to invalidate it somewhat quickly. If we keep this data for very long, site administrators are more likely to see incorrect results if they upgrade to a newer version of a module or theme but do not visit certain pages that automatically clear this cache.</p>
<dl class="section see"><dt>See also:</dt><dd><a class="el" href="update_8compare_8inc.html#ad14173209d3e9cf76fbd6d6d1977de05">update_process_project_info()</a> </dd>
<dd>
<a class="el" href="update_8compare_8inc.html#aa0663304dc4634e4109c896f214ea791">update_calculate_project_data()</a> </dd>
<dd>
<a class="el" href="update_8compare_8inc.html#a958705ecce49b020722280decff3f644">update_project_cache()</a> </dd></dl>

</div>
</div>
<a class="anchor" id="ad14173209d3e9cf76fbd6d6d1977de05"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="update_8compare_8inc.html#ad14173209d3e9cf76fbd6d6d1977de05">update_process_project_info</a> </td>
          <td>(</td>
          <td class="paramtype">&amp;$&#160;</td>
          <td class="paramname"><em>projects</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Process the list of projects on the system to figure out the currently installed versions, and other information that is required before we can compare against the available releases to produce the status report.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">$projects</td><td>Array of project information from <a class="el" href="update_8compare_8inc.html#a7e1ea49d91f2d2b81b8101d481d10300">update_get_projects()</a>. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a958705ecce49b020722280decff3f644"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="update_8compare_8inc.html#a958705ecce49b020722280decff3f644">update_project_cache</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>cid</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Retrieve data from {cache_update} or empty the cache when necessary.</p>
<p>Two very expensive arrays computed by this module are the list of all installed modules and themes (and .info data, project associations, etc), and the current status of the site relative to the currently available releases. These two arrays are cached in the {cache_update} table and used whenever possible. The cache is cleared whenever the administrator visits the status report, available updates report, or the module or theme administration pages, since we should always recompute the most current values on any of those pages.</p>
<p>Note: while both of these arrays are expensive to compute (in terms of disk I/O and some fairly heavy CPU processing), neither of these is the actual data about available updates that we have to fetch over the network from updates.drupal.org. That information is stored with the 'update_available_releases' cache ID -- it needs to persist longer than 1 hour and never get invalidated just by visiting a page on the site.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">$cid</td><td>The cache id of data to return from the cache. Valid options are 'update_project_data' and 'update_project_projects'.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>The cached value of the $projects array generated by <a class="el" href="update_8compare_8inc.html#aa0663304dc4634e4109c896f214ea791">update_calculate_project_data()</a> or <a class="el" href="update_8compare_8inc.html#a7e1ea49d91f2d2b81b8101d481d10300">update_get_projects()</a>, or an empty array when the cache is cleared. </dd></dl>

</div>
</div>
</div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Sun May 13 2012 05:35:55 for Drupal by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.0
</small></address>

</body>
</html>
