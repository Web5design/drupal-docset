<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Drupal: modules/update/update.authorize.inc File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Drupal
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">modules/update/update.authorize.inc File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a640c629480dadbca39814ac8be63e21b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8authorize_8inc.html#a640c629480dadbca39814ac8be63e21b">update_authorize_run_update</a> ($filetransfer, $projects)</td></tr>
<tr class="memitem:a284ce6e21de87c3f0e39bbde1a1b6556"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8authorize_8inc.html#a284ce6e21de87c3f0e39bbde1a1b6556">update_authorize_run_install</a> ($filetransfer, $project, $updater_name, $local_url)</td></tr>
<tr class="memitem:ad3fccf701ff21f38940f28a72998d2b2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8authorize_8inc.html#ad3fccf701ff21f38940f28a72998d2b2">update_authorize_batch_copy_project</a> ($project, $updater_name, $local_url, $filetransfer, &amp;$context)</td></tr>
<tr class="memitem:af57a6cf83861d59b3aa904b3d68c1f73"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8authorize_8inc.html#af57a6cf83861d59b3aa904b3d68c1f73">update_authorize_update_batch_finished</a> ($success, $results)</td></tr>
<tr class="memitem:a5fa685f8381c4bb3cd5e2a237e82e5a4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8authorize_8inc.html#a5fa685f8381c4bb3cd5e2a237e82e5a4">update_authorize_install_batch_finished</a> ($success, $results)</td></tr>
<tr class="memitem:a52e1e0077fe627d777ce1089da0c6b9d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8authorize_8inc.html#a52e1e0077fe627d777ce1089da0c6b9d">_update_batch_create_message</a> (&amp;$project_results, $message, $success=TRUE)</td></tr>
<tr class="memitem:a040122d69ea274f33e081405f8f522ee"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8authorize_8inc.html#a040122d69ea274f33e081405f8f522ee">_update_authorize_clear_update_status</a> ()</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Callbacks and related functions invoked by <a class="el" href="authorize_8php.html">authorize.php</a> to update projects on the Drupal site. We use the Batch API to actually update each individual project on the site. All of the code in this file is run at a low bootstrap level (modules are not loaded), so these functions cannot assume access to the rest of the update module code. </p>
</div><hr/><h2>Function Documentation</h2>
<a class="anchor" id="a040122d69ea274f33e081405f8f522ee"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="update_8authorize_8inc.html#a040122d69ea274f33e081405f8f522ee">_update_authorize_clear_update_status</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Private helper function to clear cached available update status data.</p>
<p>Since this function is run at such a low bootstrap level, update.module is not loaded. So, we can't just call _update_cache_clear(). However, the database is bootstrapped, so we can do a query ourselves to clear out what we want to clear.</p>
<p>Note that we do not want to just truncate the table, since that would remove items related to currently pending fetch attempts.</p>
<dl class="section see"><dt>See also:</dt><dd><a class="el" href="update_8authorize_8inc.html#af57a6cf83861d59b3aa904b3d68c1f73">update_authorize_update_batch_finished()</a> </dd>
<dd>
_update_cache_clear() </dd></dl>

</div>
</div>
<a class="anchor" id="a52e1e0077fe627d777ce1089da0c6b9d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="update_8authorize_8inc.html#a52e1e0077fe627d777ce1089da0c6b9d">_update_batch_create_message</a> </td>
          <td>(</td>
          <td class="paramtype">&amp;$&#160;</td>
          <td class="paramname"><em>project_results</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>success</em> = <code>TRUE</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Helper function to create a structure of log messages.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$project_results</td><td></td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$message</td><td></td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$success</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ad3fccf701ff21f38940f28a72998d2b2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="update_8authorize_8inc.html#ad3fccf701ff21f38940f28a72998d2b2">update_authorize_batch_copy_project</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>project</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>updater_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>local_url</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>filetransfer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&amp;$&#160;</td>
          <td class="paramname"><em>context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Copy a project to its proper place when authorized with elevated privileges.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$project</td><td>The canonical short name of the project being installed. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$updater_name</td><td>The name of the <a class="el" href="class_updater.html">Updater</a> class to use for installing this project. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$local_url</td><td>The URL to the locally installed temp directory where the project has already been downloaded and extracted into. </td></tr>
    <tr><td class="paramtype"><a class="el" href="class_file_transfer.html">FileTransfer</a></td><td class="paramname">$filetransfer</td><td>The <a class="el" href="class_file_transfer.html">FileTransfer</a> object to use for performing this operation. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$context</td><td>Reference to an array used for BatchAPI storage. </td></tr>
  </table>
  </dd>
</dl>
<p>The batch API uses a session, and since all the arguments are serialized and unserialized between requests, although the <a class="el" href="class_file_transfer.html">FileTransfer</a> object itself will be reconstructed, the connection pointer itself will be lost. However, the <a class="el" href="class_file_transfer.html">FileTransfer</a> object will still have the connection variable, even though the connection itself is now gone. So, although it's ugly, we have to unset the connection variable at this point so that the <a class="el" href="class_file_transfer.html">FileTransfer</a> object will re-initiate the actual connection.</p>

</div>
</div>
<a class="anchor" id="a5fa685f8381c4bb3cd5e2a237e82e5a4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="update_8authorize_8inc.html#a5fa685f8381c4bb3cd5e2a237e82e5a4">update_authorize_install_batch_finished</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>success</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>results</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Batch callback for when the authorized install batch is finished.</p>
<p>This processes the results and stashes them into SESSION such that <a class="el" href="authorize_8php.html">authorize.php</a> will render a report. Also responsible for putting the site back online after a successful install if necessary. </p>

</div>
</div>
<a class="anchor" id="a284ce6e21de87c3f0e39bbde1a1b6556"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="update_8authorize_8inc.html#a284ce6e21de87c3f0e39bbde1a1b6556">update_authorize_run_install</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>filetransfer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>project</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>updater_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>local_url</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Callback invoked by <a class="el" href="authorize_8php.html">authorize.php</a> to install a new project.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramtype"><a class="el" href="class_file_transfer.html">FileTransfer</a></td><td class="paramname">$filetransfer</td><td>The <a class="el" href="class_file_transfer.html">FileTransfer</a> object created by <a class="el" href="authorize_8php.html">authorize.php</a> for use during this operation. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$project</td><td>The canonical project short name (e.g. {system}.name). </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$updater_name</td><td>The name of the <a class="el" href="class_updater.html">Updater</a> class to use for installing this project. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$local_url</td><td>The URL to the locally installed temp directory where the project has already been downloaded and extracted into. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a640c629480dadbca39814ac8be63e21b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="update_8authorize_8inc.html#a640c629480dadbca39814ac8be63e21b">update_authorize_run_update</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>filetransfer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>projects</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Callback invoked by <a class="el" href="authorize_8php.html">authorize.php</a> to update existing projects.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">$filetransfer</td><td>The <a class="el" href="class_file_transfer.html">FileTransfer</a> object created by <a class="el" href="authorize_8php.html">authorize.php</a> for use during this operation. </td></tr>
    <tr><td class="paramname">$projects</td><td>A nested array of projects to install into the live webroot, keyed by project name. Each subarray contains the following keys:<ul>
<li>'project': The canonical project short name.</li>
<li>'updater_name': The name of the <a class="el" href="class_updater.html">Updater</a> class to use for this project.</li>
<li>'local_url': The locally installed location of new code to update with. </li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="af57a6cf83861d59b3aa904b3d68c1f73"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="update_8authorize_8inc.html#af57a6cf83861d59b3aa904b3d68c1f73">update_authorize_update_batch_finished</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>success</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>results</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Batch callback for when the authorized update batch is finished.</p>
<p>This processes the results and stashes them into SESSION such that <a class="el" href="authorize_8php.html">authorize.php</a> will render a report. Also responsible for putting the site back online and clearing the update status cache after a successful update. </p>

</div>
</div>
</div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Sun May 13 2012 05:35:55 for Drupal by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.0
</small></address>

</body>
</html>
