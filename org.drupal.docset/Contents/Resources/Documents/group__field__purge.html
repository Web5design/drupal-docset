<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Drupal: Field API bulk data deletion</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Drupal
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Field API bulk data deletion</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gac0dcacb53338e25ac4e2add6b427757e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__field__purge.html#gac0dcacb53338e25ac4e2add6b427757e">field_purge_batch</a> ($batch_size)</td></tr>
<tr class="memitem:ga93ec2f273b56141a5079bfaf25d6b80e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__field__purge.html#ga93ec2f273b56141a5079bfaf25d6b80e">field_purge_data</a> ($entity_type, $entity, $field, $instance)</td></tr>
<tr class="memitem:ga766cee439c7c920d3d406c7af41c8968"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__field__purge.html#ga766cee439c7c920d3d406c7af41c8968">field_purge_instance</a> ($instance)</td></tr>
<tr class="memitem:gac52122a65da997921f3a6a8f45deddbf"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__field__purge.html#gac52122a65da997921f3a6a8f45deddbf">field_purge_field</a> ($field)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<p>End of "defgroup field_crud".</p>
<p>Clean up after Field API bulk deletion operations.</p>
<p>Field API provides functions for deleting data attached to individual entities as well as deleting entire fields or field instances in a single operation.</p>
<p>Deleting field data items for an entity with <a class="el" href="group__field__attach.html#gac2e3658c9c02d0d0e71359f9ef2f207a">field_attach_delete()</a> involves three separate operations:</p>
<ul>
<li>Invoking the Field Type API <a class="el" href="group__field__types.html#gaf1e5787044b83d34cf7daed3d5297336">hook_field_delete()</a> for each field on the entity. The hook for each field type receives the entity and the specific field being deleted. A file field module might use this hook to delete uploaded files from the filesystem.</li>
<li>Invoking the Field Storage API <a class="el" href="group__field__storage.html#ga64bd5adc0e4ccc1fe52fbaabcfa10274">hook_field_storage_delete()</a> to remove data from the primary field storage. The hook implementation receives the entity being deleted and deletes data for all of the entity's bundle's fields.</li>
<li>Invoking the global Field Attach API <a class="el" href="group__field__attach.html#gac9e5a9e43f1290315db8b593b9516094">hook_field_attach_delete()</a> for all modules that implement it. Each hook implementation receives the entity being deleted and can operate on whichever subset of the entity's bundle's fields it chooses to.</li>
</ul>
<p>These hooks are invoked immediately when <a class="el" href="group__field__attach.html#gac2e3658c9c02d0d0e71359f9ef2f207a">field_attach_delete()</a> is called. Similar operations are performed for <a class="el" href="group__field__attach.html#gaa9eae65e6d9f1996cb27a55ba25b56e9">field_attach_delete_revision()</a>.</p>
<p>When a field, bundle, or field instance is deleted, it is not practical to invoke these hooks immediately on every affected entity in a single page request; there could be thousands or millions of them. Instead, the appropriate field data items, instances, and/or fields are marked as deleted so that subsequent load or query operations will not return them. Later, a separate process cleans up, or "purges", the marked-as-deleted data by going through the three-step process described above and, finally, removing deleted field and instance records.</p>
<p>Purging field data is made somewhat tricky by the fact that, while <a class="el" href="group__field__attach.html#gac2e3658c9c02d0d0e71359f9ef2f207a">field_attach_delete()</a> has a complete entity to pass to the various deletion hooks, the Field API purge process only has the field data it has previously stored. It cannot reconstruct complete original entities to pass to the deletion hooks. It is even possible that the original entity to which some Field API data was attached has been itself deleted before the field purge operation takes place.</p>
<p>Field API resolves this problem by using "pseudo-entities" during purge operations. A pseudo-entity contains only the information from the original entity that Field API knows about: entity type, id, revision id, and bundle. It also contains the field data for whichever field instance is currently being purged. For example, suppose that the node type 'story' used to contain a field called 'subtitle' but the field was deleted. If node 37 was a story with a subtitle, the pseudo-entity passed to the purge hooks would look something like this:</p>
<div class="fragment"><pre class="fragment">   $entity = stdClass Object(
     [nid] =&gt; 37,
     [vid] =&gt; 37,
     [type] =&gt; <span class="stringliteral">&#39;story&#39;</span>,
     [subtitle] =&gt; array(
       [0] =&gt; array(
         <span class="stringliteral">&#39;value&#39;</span> =&gt; <span class="stringliteral">&#39;subtitle text&#39;</span>,
       ),
     ),
   );
</pre></div><p>See <a class="el" href="">Field API </a> for information about the other parts of the Field API. </p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="gac0dcacb53338e25ac4e2add6b427757e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__field__purge.html#gac0dcacb53338e25ac4e2add6b427757e">field_purge_batch</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>batch_size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Purges a batch of deleted Field API data, instances, or fields.</p>
<p>This function will purge deleted field data in batches. The batch size is defined as an argument to the function, and once each batch is finished, it continues with the next batch until all have completed. If a deleted field instance with no remaining data records is found, the instance itself will be purged. If a deleted field with no remaining field instances is found, the field itself will be purged.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">$batch_size</td><td>The maximum number of field data records to purge before returning. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga93ec2f273b56141a5079bfaf25d6b80e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__field__purge.html#ga93ec2f273b56141a5079bfaf25d6b80e">field_purge_data</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>entity_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>entity</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>field</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>instance</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Purges the field data for a single field on a single pseudo-entity.</p>
<p>This is basically the same as <a class="el" href="group__field__attach.html#gac2e3658c9c02d0d0e71359f9ef2f207a">field_attach_delete()</a> except it only applies to a single field. The entity itself is not being deleted, and it is quite possible that other field data will remain attached to it.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">$entity_type</td><td>The type of $entity; e.g. 'node' or 'user'. </td></tr>
    <tr><td class="paramname">$entity</td><td>The pseudo-entity whose field data is being purged. </td></tr>
    <tr><td class="paramname">$field</td><td>The (possibly deleted) field whose data is being purged. </td></tr>
    <tr><td class="paramname">$instance</td><td>The deleted field instance whose data is being purged. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="gac52122a65da997921f3a6a8f45deddbf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__field__purge.html#gac52122a65da997921f3a6a8f45deddbf">field_purge_field</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>field</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Purges a field record from the database.</p>
<p>This function assumes all instances for the field has already been purged, and should only be called by <a class="el" href="group__field__purge.html#gac0dcacb53338e25ac4e2add6b427757e">field_purge_batch()</a>.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">$field</td><td>The field record to purge. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga766cee439c7c920d3d406c7af41c8968"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__field__purge.html#ga766cee439c7c920d3d406c7af41c8968">field_purge_instance</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>instance</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Purges a field instance record from the database.</p>
<p>This function assumes all data for the instance has already been purged, and should only be called by <a class="el" href="group__field__purge.html#gac0dcacb53338e25ac4e2add6b427757e">field_purge_batch()</a>.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">$instance</td><td>The instance record to purge. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Sun May 13 2012 05:35:56 for Drupal by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.0
</small></address>

</body>
</html>
